<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>花火タッチ 完全版</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background-color: #000;
    background-image: url('h3.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    touch-action: none;
    transition: background-image 1s ease;
}

body.animate-bg {
    animation: bgMoveZoom 40s linear infinite;
}

@keyframes bgMoveZoom {
    0% { transform: scale(1.2) translate(0,0); background-position:center center; }
    50% { transform: scale(1.25) translate(-2%,2%); background-position:60% 40%; }
    100% { transform: scale(1.2) translate(0,0); background-position:center center; }
}

.firework {
    position: absolute;
    pointer-events: none;
    transition: opacity 1.1s ease-out;
}

.rocket {
    position: absolute;
    width: 15px;
    height: 100px;
    background: linear-gradient(to top, rgba(255,255,255,0), #fff);
    pointer-events: none;
    opacity: 1;
    transform-origin: 50% 100%;
}
</style>
</head>
<body class="animate-bg">

<script>
const NUM_VARIANTS = 8;
const MAX_FIREWORKS = 50;
let currentFireworks = 0;
let launchSound = null;
let fadeOutInterval = null;

function launchFirework(x, y, size = null) {
    if (currentFireworks >= MAX_FIREWORKS) return;
    currentFireworks++;
    const randIndex = Math.floor(Math.random() * NUM_VARIANTS) + 1;
    const fwSize = size || (Math.floor(Math.random() * 200) + 250);
    const hueRotate = Math.floor(Math.random() * 360);

    const gif = document.createElement('img');
    gif.src = `hanabi${randIndex}.gif?${Date.now()}`;
    gif.className = 'firework';
    gif.style.width = `${fwSize}px`;
    gif.style.left = `${x - fwSize / 2}px`;
    gif.style.top = `${y - fwSize / 2}px`;
    gif.style.filter = `hue-rotate(${hueRotate}deg) drop-shadow(0 0 7px rgba(255,255,255,0.7)) drop-shadow(0 0 15px rgba(255,255,255,0.5))`;
    document.body.appendChild(gif);

    setTimeout(() => { gif.style.opacity = '0'; }, 1100);
    setTimeout(() => { gif.remove(); currentFireworks = Math.max(0,currentFireworks-1); }, 2200);

    const audio = new Audio(`hanabi${randIndex}.mp3`);
    audio.play();
}

function launchRocketToTarget(targetX, targetY) {
    const rocket = document.createElement('div');
    rocket.className = 'rocket';
    const rocketHeight = 100; 
    const rocketWidth = 15; 

    const startX = window.innerWidth / 2;
    const startY = window.innerHeight;

    rocket.style.left = `${startX - rocketWidth/2}px`;
    rocket.style.top = `${startY - rocketHeight}px`;
    document.body.appendChild(rocket);

    const deltaX = targetX - startX;
    const deltaY = targetY - startY;
    const angleRad = Math.atan2(deltaY, deltaX);
    const angleDeg = angleRad * 180 / Math.PI + 90;

    rocket.style.transform = `translate(0px, 0px) rotate(${angleDeg}deg)`;

    if (launchSound) {
        launchSound.pause();
        clearInterval(fadeOutInterval);
    }
    launchSound = new Audio('hyu.mp3');
    launchSound.play();

    rocket.style.transition = 'transform 2s ease-out, height 0.5s ease, opacity 0.5s ease';
    setTimeout(() => {
        rocket.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${angleDeg}deg)`;
    }, 10);

    // 花火到達で線を縮めながら消す
    setTimeout(() => {
        rocket.style.height = '0px';
        rocket.style.opacity = '0';
        setTimeout(() => rocket.remove(), 500);

        // 発射音フェードアウト
        fadeOutInterval = setInterval(() => {
            if (launchSound && launchSound.volume > 0.1) {
                launchSound.volume -= 0.1;
            } else {
                if (launchSound) { launchSound.volume = 0; launchSound.pause(); }
                clearInterval(fadeOutInterval);
            }
        }, 50);

        launchFirework(targetX, targetY);
    }, 2000);
}

// クリックで花火
document.body.addEventListener('click', (e) => {
    launchRocketToTarget(e.pageX, e.pageY);
});

// 特殊花火（右クリック・中央クリック）
function launchSpecialFirework(count = 1) {
    for (let i=0;i<count;i++){
        const targetX = window.innerWidth*(0.3 + Math.random()*0.4);
        const targetY = window.innerHeight*(0.2 + Math.random()*0.4);
        launchRocketToTarget(targetX,targetY);
    }
}

document.body.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    launchSpecialFirework(1);
});

document.body.addEventListener('mousedown', (e) => {
    if (e.button === 1) {
        e.preventDefault();
        launchSpecialFirework(3);
    }
});

// タッチスクロール防止
document.addEventListener('touchmove', e => e.preventDefault(), {passive:false});
</script>
</body>
</html>
