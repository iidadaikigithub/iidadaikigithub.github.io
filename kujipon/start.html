<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>くじゲーム</title>
  <style>
    body {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-content: flex-start;
      gap: 15px;
      padding: 30px;
      background-color: #fff;
      margin: 0;
      touch-action: manipulation;
      user-select: none;
    }
    .kuji {
      width: 120px;
      height: 120px;
      position: relative;
      border: 4px solid red;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
    }
    .kuji.clicked {
      filter: grayscale(1);
      pointer-events: none;
    }
    .kuji img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: hue-rotate(0deg);
    }
    .kuji img.overlay {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <script>
    const params = JSON.parse(localStorage.getItem('kujiConfig')) || {
      kujiCount: 10,
      atariCount: 3,
      hazureCount: 2,
      seikaiSound: 'random',
      hazureSound: 'random'
    };

    const total = parseInt(params.kujiCount);
    const ataris = Array(parseInt(params.atariCount)).fill('atari');
    const hazures = Array(parseInt(params.hazureCount)).fill('hazure');
    const sukas = Array(total - ataris.length - hazures.length).fill('suka');
    const pool = [...ataris, ...hazures, ...sukas].sort(() => Math.random() - 0.5);

    const hueStep = 360 / total;

    for (let i = 0; i < total; i++) {
      const kuji = document.createElement('div');
      kuji.className = 'kuji';

      const img = document.createElement('img');
      img.src = '1.png';
      img.style.filter = `hue-rotate(${i * hueStep}deg)`;

      kuji.appendChild(img);

      kuji.onclick = (e) => {
        if (e.button !== 0) return;
        kuji.classList.add('clicked');
        const type = pool[i];
        if (type === 'atari') {
          const overlay = document.createElement('img');
          overlay.src = 'seikai.gif';
          overlay.className = 'overlay';
          kuji.appendChild(overlay);
          playSeikai();
        } else if (type === 'hazure') {
          const overlay = document.createElement('img');
          overlay.src = 'hazure.gif';
          overlay.className = 'overlay';
          kuji.appendChild(overlay);
          playHazure();
        } else {
          playSuka();
        }
      };

      document.body.appendChild(kuji);
    }

    function playSeikai() {
      if (params.seikaiSound === 'random') {
        const r = Math.floor(Math.random() * 5) + 1;
        new Audio(`正解${r}.mp3`).play();
      } else {
        new Audio(`${params.seikaiSound}.mp3`).play();
      }
    }

    function playHazure() {
      if (params.hazureSound === 'random') {
        const sounds = ['ブー1', 'ブー2', 'ブー3', 'ブー4', 'ブー5', '爆発1', '爆発2', '爆発3', '爆発4'];
        const s = sounds[Math.floor(Math.random() * sounds.length)];
        new Audio(`${s}.mp3`).play();
      } else {
        new Audio(`${params.hazureSound}.mp3`).play();
      }
    }

    function playSuka() {
      new Audio('suka.mp3').play();
    }

    // 無効化処理
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('gesturestart', e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('gestureend', e => e.preventDefault());
  </script>
</body>
</html>
