<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ç”»é¢</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      position: relative;
      user-select: none;
      touch-action: manipulation;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
    }
    #total {
      font-size: 1.2em;
      font-weight: bold;
    }
    .fixed-button {
      position: fixed;
      padding: 10px 16px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      z-index: 100;
    }
    #payButton {
      bottom: 20px;
      right: 20px;
      background-color: pink;
    }
    #bagButton {
      bottom: 70px;
      right: 20px;
      background-color: #eee;
    }
    #deleteButton {
      bottom: 20px;
      left: 20px;
      background-color: #ffcccc;
    }
  </style>
</head>
<body>

<h2>ãƒ¬ã‚¸ç”»é¢ï¼ˆå·¦ã‚¯ãƒªãƒƒã‚¯ã§å•†å“è¿½åŠ ï¼‰</h2>

<table id="receipt">
  <thead>
    <tr>
      <th>No.</th>
      <th>å•†å“åç§°</th>
      <th>æ•°é‡</th>
      <th>é‡‘é¡</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<div id="total">åˆè¨ˆ: ï¿¥0</div>

<button id="payButton" class="fixed-button">ãŠä¼šè¨ˆ</button>
<button id="bagButton" class="fixed-button">è¢‹ã¯å…¥ã‚Šã¾ã™ã‹ï¼Ÿ</button>
<button id="deleteButton" class="fixed-button">ğŸ—‘ï¸ å‰Šé™¤</button>

<script>
  const taxRate = 0.10;
  const itemPrice = 100;
  let saidYes = new URLSearchParams(location.search).get("bag") === "1";

  // å•†å“ã‚«ã‚¦ãƒ³ãƒˆã¯è¢‹ãŒã‚ã‚Œã°0ã‚¹ã‚¿ãƒ¼ãƒˆã€ãªã‘ã‚Œã°0ã‹ã‚‰å¢—ã‚„ã™
  let itemCount = 0;

  const tbody = document.querySelector('#receipt tbody');

  // è¢‹ï¼ˆãµãã‚ï¼‰ãŒã‚ã‚‹å ´åˆã¯å…ˆã«ä¸€è¡Œè¿½åŠ ï¼ˆNo.1ã«ï¼‰
  if (saidYes) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>1</td>
      <td>ãµãã‚</td>
      <td>1</td>
      <td>ï¿¥5</td>
    `;
    tbody.appendChild(row);
  }

  // å•†å“è¿½åŠ ãƒœã‚¿ãƒ³ã¯è¢‹åˆ†ã‚’è€ƒæ…®ã—ã¦ç•ªå·æŒ¯ã‚‹
  document.body.addEventListener('click', (e) => {
    if (e.target.closest('button')) return;

    itemCount++;
    const row = document.createElement('tr');
    const displayNo = (saidYes ? itemCount + 1 : itemCount);
    row.innerHTML = `
      <td>${displayNo}</td>
      <td>å•†å“${itemCount}</td>
      <td>1</td>
      <td>ï¿¥${itemPrice}</td>
    `;
    tbody.appendChild(row);
    updateTotal();
  });

  // åˆè¨ˆè¨ˆç®—ï¼šè¢‹ã¯å˜ä¾¡5å††ï¼ˆæ¶ˆè²»ç¨ã¯è¨ˆç®—ã—ãªã„ï¼‰ã€ãã®ä»–å•†å“ã¯100å††Ã—æ•°é‡ã«æ¶ˆè²»ç¨10%ã‚’ã‹ã‘ã‚‹
  function updateTotal() {
    let subtotal = 0;

    // tbodyã®è¡Œã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦åˆè¨ˆè¨ˆç®—
    for (const row of tbody.children) {
      const name = row.cells[1].textContent;
      const priceStr = row.cells[3].textContent.replace('ï¿¥', '');
      let price = parseInt(priceStr, 10);
      if (name === 'ãµãã‚') {
        subtotal += 5; // è¢‹ã¯ç¨è¾¼ã¿5å††ã¨ã—ã¦å›ºå®š
      } else {
        subtotal += price;
      }
    }
    const total = Math.round(subtotal * (1 + taxRate));
    document.getElementById('total').textContent = `åˆè¨ˆ: ï¿¥${total}`;
  }

  // å‰Šé™¤ãƒœã‚¿ãƒ³ï¼šæœ€å¾Œã®è¡Œã‚’å‰Šé™¤ã€è¢‹ã¯å‰Šé™¤ä¸å¯
  document.getElementById('deleteButton').addEventListener('click', () => {
    if (tbody.children.length === 0) return;
    // è¢‹ãŒã‚ã‚Œã°ä¸€ç•ªæœ€åˆã®è¡Œã¯ãµãã‚ãªã®ã§å‰Šé™¤ä¸å¯ã€æœ€å¾Œã®è¡ŒãŒè¢‹ã‹åˆ¤åˆ¥
    const lastRow = tbody.lastElementChild;
    if (lastRow.cells[1].textContent === 'ãµãã‚') {
      // è¢‹ã ã‘ãªã‚‰ä½•ã‚‚ã—ãªã„
      if (tbody.children.length === 1) return;
      // è¢‹ãŒæœ€åˆã«ã‚ã‚Šã€æœ€å¾Œã¯åˆ¥å•†å“ãªã‚‰å‰Šé™¤å¯èƒ½
    }
    // å‰Šé™¤å‡¦ç†
    tbody.removeChild(lastRow);
    itemCount--;
    updateTotal();
  });

  document.getElementById('payButton').addEventListener('click', () => {
    let subtotal = 0;
    for (const row of tbody.children) {
      const name = row.cells[1].textContent;
      const priceStr = row.cells[3].textContent.replace('ï¿¥', '');
      let price = parseInt(priceStr, 10);
      if (name === 'ãµãã‚') {
        subtotal += 5;
      } else {
        subtotal += price;
      }
    }
    const total = Math.round(subtotal * (1 + taxRate));
    window.location.href = `payment.html?amount=${total}`;
  });

  document.getElementById('bagButton').addEventListener('click', () => {
    window.location.href = "index.html";
  });

  // åˆæœŸåˆè¨ˆè¡¨ç¤º
  updateTotal();
</script>

</body>
</html>
