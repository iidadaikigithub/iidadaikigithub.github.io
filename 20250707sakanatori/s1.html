<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>さかなとりゲーム</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      position: relative;
    }
    #layer1 {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
    }
    #layer2 {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 2;
    }
    #sakana-container, #caught-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: auto;
      z-index: 3;
    }
    .sakana {
      position: absolute;
      pointer-events: auto;
      cursor: pointer;
    }
    .caught {
      position: absolute;
    }
    #suisou {
      position: absolute;
      right: 0;
      bottom: 0;
      width: 200px;
      height: auto;
      z-index: 5;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <img src="haikei.png" id="layer1">
  <img src="haikei2.png" id="layer2">
  <div id="sakana-container"></div>
  <div id="caught-container"></div>
  <img src="suisou.png" id="suisou">

  <script>
    const sakanaContainer = document.getElementById('sakana-container');
    const caughtContainer = document.getElementById('caught-container');
    const sakanaImages = ['sakana.gif', 'sakana2.gif'];

    function createSakana() {
      const img = document.createElement('img');
      img.src = sakanaImages[Math.floor(Math.random() * sakanaImages.length)];
      img.classList.add('sakana');
      img.style.width = `${30 + Math.random() * 70}px`;
      img.style.top = `${Math.random() * window.innerHeight * 0.8}px`;
      let x = Math.random() * window.innerWidth;
      let direction = Math.random() < 0.5 ? 1 : -1;
      let speed = 1 + Math.random() * 2;
      img.style.left = `${x}px`;
      sakanaContainer.appendChild(img);

      function move() {
        x += direction * speed;
        img.style.left = `${x}px`;
        if (x < -100 || x > window.innerWidth + 100) {
          sakanaContainer.removeChild(img);
        } else {
          requestAnimationFrame(move);
        }
      }
      move();

      img.addEventListener('click', () => catchSakana(img));
    }

    function catchSakana(sakana) {
      sakana.remove();
      const newSakana = sakana.cloneNode();
      newSakana.classList.remove('sakana');
      newSakana.classList.add('caught');
      caughtContainer.appendChild(newSakana);
      animateCaught(newSakana);
    }

    function animateCaught(sakana) {
      const tank = document.getElementById('suisou');
      const tankRect = tank.getBoundingClientRect();
      let x = tank.offsetLeft + Math.random() * tank.offsetWidth * 0.7;
      let y = tank.offsetTop + Math.random() * tank.offsetHeight * 0.7;
      sakana.style.left = `${x}px`;
      sakana.style.top = `${y}px`;
      sakana.style.width = `${20 + Math.random() * 40}px`;

      let dx = (Math.random() < 0.5 ? -1 : 1) * (1 + Math.random());
      let dy = (Math.random() < 0.5 ? -1 : 1) * (0.5 + Math.random());

      function swim() {
        x += dx;
        y += dy;
        const maxX = tank.offsetLeft + tank.offsetWidth - 40;
        const maxY = tank.offsetTop + tank.offsetHeight - 40;
        const minX = tank.offsetLeft;
        const minY = tank.offsetTop;

        if (Math.random() < 0.01) {
          dx = 0;
          dy = 0;
        } else {
          if (x < minX || x > maxX) dx *= -1;
          if (y < minY || y > maxY) dy *= -1;
        }

        sakana.style.left = `${x}px`;
        sakana.style.top = `${y}px`;
        requestAnimationFrame(swim);
      }
      swim();
    }

    // 魚を定期的に追加
    setInterval(createSakana, 1000);
  </script>
</body>
</html>
