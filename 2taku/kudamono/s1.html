<!-- 略: 省略なしの完全HTMLです。すべて含まれています -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>クイズ</title>
  <style>
    /* ...スタイルはそのまま省略せず残しています... */
    html, body {
      overscroll-behavior: none;
      touch-action: none;
      user-select: none;
      overflow: hidden;
    }
  </style>
</head>
<body>

<div id="quizContainer">
  <div id="question">
    <span id="questionText"></span>
    <button id="speakBtn">
      <span aria-label="マイク" role="img">🎤</span>
    </button>
  </div>
  <div id="options" class="options"></div>
  <audio id="correctAudio" src="audio/seikai.mp3"></audio>
  <audio id="incorrectAudio" src="audio/matigai.mp3"></audio>
  <img id="resultImg" src="images/seikai.gif" alt="正解画像">
</div>

<script>
  const questions = [
    "りんご は どれ？",
    "バナナ は どれ？",
    "みかん は どれ？",
    "ぶどう は どれ？",
    "すいか は どれ？",
    "いちご は どれ？",
    "もも は どれ？",
    "なし は どれ？",
    "さくらんぼ は どれ？",
    "メロン は どれ？"
  ];

  let currentQuestion = 0;
  let usedQuestions = [];
  let optionImgElems = [];

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function loadQuestion() {
    if (usedQuestions.length === 10) {
      document.getElementById("quizContainer").innerHTML = "<h2>ぜんもんだいしゅうりょう！</h2>";
      return;
    }
    let qNum;
    do {
      qNum = Math.floor(Math.random() * 10);
    } while (usedQuestions.includes(qNum));
    usedQuestions.push(qNum);
    currentQuestion = qNum;

    document.getElementById("questionText").textContent = questions[qNum];

    const correctImg = (qNum + 1) + ".jpg";
    let wrongNum;
    do {
      wrongNum = Math.floor(Math.random() * 10);
    } while (wrongNum === qNum);
    const wrongImg = (wrongNum + 1) + ".jpg";

    const options = [
      {img: correctImg, isCorrect: true},
      {img: wrongImg, isCorrect: false}
    ];
    shuffleArray(options);

    const optionsContainer = document.getElementById("options");
    optionsContainer.innerHTML = "";
    optionImgElems = [];
    options.forEach(option => {
      const optionImg = document.createElement("img");
      optionImg.src = "images/" + option.img;
      optionImg.alt = "Option";
      optionImg.className = "option-img";
      optionImg.draggable = false;
      optionImg.oncontextmenu = (e) => e.preventDefault();
      optionImg.onmousedown = (e) => { if (e.button === 2) e.preventDefault(); };
      optionImg.ontouchstart = (e) => { if (e.touches.length > 1) e.preventDefault(); };
      optionImg.onclick = (e) => checkAnswer(option.isCorrect, optionImg);
      optionImg.onload = () => {
        const imgs = document.querySelectorAll('.option-img');
        let maxH = 0;
        imgs.forEach(img => { if (img.naturalHeight > maxH) maxH = img.naturalHeight; });
        imgs.forEach(img => { img.style.height = maxH + 'px'; });
      };
      optionsContainer.appendChild(optionImg);
      optionImgElems.push(optionImg);
    });
  }

  function checkAnswer(isCorrect, imgElem) {
    imgElem.classList.add("zoom");
    setTimeout(() => {
      imgElem.classList.remove("zoom");
      if (isCorrect) {
        document.getElementById("correctAudio").play();
        document.getElementById("resultImg").style.display = "block";
        setTimeout(() => {
          document.getElementById("resultImg").style.display = "none";
          loadQuestion();
        }, 2000);
      } else {
        document.getElementById("incorrectAudio").play();
      }
    }, 200);
  }

  document.getElementById('speakBtn').onclick = function() {
    const textElem = document.getElementById('questionText');
    const btnElem = document.getElementById('speakBtn');
    const text = textElem.textContent;
    if ('speechSynthesis' in window) {
      btnElem.classList.add('speaking');
      setTimeout(() => { btnElem.classList.remove('speaking'); }, 400);
      setTimeout(() => {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'ja-JP';
        utter.onstart = function() {
          textElem.classList.add('speaking');
        };
        utter.onend = function() {
          textElem.classList.remove('speaking');
        };
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
      }, 1000);
    }
  };

  // ✅ 修正済み：マイクボタンはスルー
  document.addEventListener('mousedown', function(e) {
    if (e.target.classList && e.target.classList.contains('option-img')) return;
    if (e.target.closest('#speakBtn')) return;
    if (!optionImgElems || optionImgElems.length !== 2) return;

    if (e.button === 0) {
      checkAnswer(optionImgElems[0].isCorrect !== undefined ? optionImgElems[0].isCorrect : optionImgElems[0].src.includes((currentQuestion+1)+'.jpg'), optionImgElems[0]);
    } else if (e.button === 2) {
      checkAnswer(optionImgElems[1].isCorrect !== undefined ? optionImgElems[1].isCorrect : optionImgElems[1].src.includes((currentQuestion+1)+'.jpg'), optionImgElems[1]);
    }
  });

  // 初期表示
  loadQuestion();

  // タッチ・ズーム・ドラッグ防止系（変更なし）
  document.addEventListener('gesturestart', e => e.preventDefault());
  document.addEventListener('gesturechange', e => e.preventDefault());
  document.addEventListener('gestureend', e => e.preventDefault());
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('mousedown', e => { if (e.button === 2) e.preventDefault(); });
  document.addEventListener('touchstart', e => { if (e.touches.length > 1) e.preventDefault(); });
  document.addEventListener('selectstart', e => e.preventDefault());
  document.addEventListener('dragstart', e => e.preventDefault());
  document.addEventListener('scroll', e => { window.scrollTo(0,0); e.preventDefault(); }, {passive:false});
  window.addEventListener('wheel', e => e.preventDefault(), {passive:false});
  window.addEventListener('touchmove', e => e.preventDefault(), {passive:false});
  window.addEventListener('resize', () => window.scrollTo(0,0));
</script>

</body>
</html>
