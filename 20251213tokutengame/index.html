<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>04</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

.container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
}

#jpgLayer, #pngLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

#gifLayer {
  position: absolute;
  top: 0;
  left: -100vw;
  height: 100vh;
  width: auto;
  background-size: contain;
  background-position: left center;
  background-repeat: no-repeat;
  z-index: 1;
  transition: left 6s cubic-bezier(0,0,0.2,1);
  pointer-events: none;
}

@keyframes walk {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}

.walking {
  animation: walk 0.5s infinite;
}

#jpgLayer { 
  z-index: 0;
}
#pngLayer { 
  z-index: 2;
}

.button {
  position: absolute;
  top: 20px;
  padding: 10px 16px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  cursor: pointer;
  z-index: 20;
}
#backButton { left: 20px; }
#nextButton { right: 20px; }
</style>
</head>
<body>
<div class="container" id="scene">
  <div id="jpgLayer"></div>
  <div id="gifLayer"></div>
  <div id="pngLayer"></div>
</div>

<button class="button" id="backButton" onclick="history.back()">戻る</button>
<button class="button" id="nextButton" onclick="location.href='05.html'">次へ</button>

<script>
(function () {
  // 画像URLを設定（Google DriveやImgurなどの外部URLに変更してください）
  const imageUrls = {
    jpg: 'https://via.placeholder.com/800x600/333333/ffffff?text=04.jpg',
    png: 'https://via.placeholder.com/800x600/transparent/ffffff?text=04.png',
    gif: 'https://via.placeholder.com/400x600/666666/ffffff?text=04.gif',
    gifWalk: 'https://via.placeholder.com/400x600/999999/ffffff?text=04m.gif'
  };

  const gif = document.getElementById('gifLayer');
  const jpg = document.getElementById('jpgLayer');
  const png = document.getElementById('pngLayer');
  const scene = document.getElementById('scene');
  let moved = false;
  const animationDurationSec = 6;

  // 画像を設定
  jpg.style.backgroundImage = `url('${imageUrls.jpg}')`;
  png.style.backgroundImage = `url('${imageUrls.png}')`;

  function resetGifPosition() {
    gif.style.backgroundImage = `url('${imageUrls.gif}')`;
    gif.style.transition = 'none';
    gif.style.left = '-100vw';
    void gif.offsetWidth;
    gif.style.transition = `left ${animationDurationSec}s cubic-bezier(0,0,0.2,1)`;
  }

  function animateGif() {
    if (moved) return;
    moved = true;

    gif.style.backgroundImage = `url('${imageUrls.gifWalk}')`;
    gif.classList.add('walking');

    const tempImg = new Image();
    tempImg.onload = function() {
      const scale = window.innerHeight / this.naturalHeight;
      const gifWidth = this.naturalWidth * scale;
      const rightStop = window.innerWidth - gifWidth;
      gif.style.left = rightStop + 'px';

      setTimeout(() => {
        gif.style.backgroundImage = `url('${imageUrls.gif}')`;
        gif.classList.remove('walking');
      }, animationDurationSec * 1000);
    };
    tempImg.src = imageUrls.gifWalk;

    setTimeout(() => {
      gif.style.transition = 'none';
      gif.style.left = '-100vw';
      void gif.offsetWidth;
      gif.style.transition = `left ${animationDurationSec}s cubic-bezier(0,0,0.2,1)`;
      gif.style.left = '0px';
    }, 10);
  }

  window.addEventListener('load', resetGifPosition);
  window.addEventListener('resize', () => {
    if (!moved) resetGifPosition();
  });

  scene.addEventListener('click', (e) => {
    if (!e.target.closest('button')) animateGif();
  });
  scene.addEventListener('touchstart', (e) => {
    if (!e.target.closest('button')) animateGif();
  });
})();
</script>
</body>
</html>
