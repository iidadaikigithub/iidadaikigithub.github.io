<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>09</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

/* 全画面固定コンテナ */
.container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
}

/* jpg / png は画面ぴったり */
#jpgLayer, #pngLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: fill;
}

/* gif3体は縦を合わせて左端から等間隔でスタート */
#gifLayer1, #gifLayer2, #gifLayer3 {
  position: absolute;
  top: 0;
  height: 100vh;
  width: auto;
  object-fit: contain;
  z-index: 1;
  transition: left 6s cubic-bezier(0,0,0.2,1);
  pointer-events: none;
}
#gifLayer1 { left: 0; }
#gifLayer2 { left: -120vw; }
#gifLayer3 { left: -240vw; }

/* レイヤー順 */
#jpgLayer { z-index: 0; }
#pngLayer { z-index: 2; }

/* ボタン */
.button {
  position: absolute;
  top: 20px;
  padding: 10px 16px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  cursor: pointer;
  z-index: 20;
}
#backButton { left: 20px; }
#nextButton { right: 20px; }
</style>
</head>
<body>
<div class="container" id="scene">
  <img src="09.jpg" id="jpgLayer" alt="jpg">
  <img src="09.gif" id="gifLayer1" alt="gif1">
  <img src="09.gif" id="gifLayer2" alt="gif2">
  <img src="09.gif" id="gifLayer3" alt="gif3">
  <img src="09.png" id="pngLayer" alt="png">
</div>

<button class="button" id="backButton" onclick="history.back()">戻る</button>
<button class="button" id="nextButton" onclick="location.href='10.html'">次へ</button>

<script>
(function () {
  const gifs = [
    document.getElementById('gifLayer1'),
    document.getElementById('gifLayer2'),
    document.getElementById('gifLayer3')
  ];
  const scene = document.getElementById('scene');
  let moveState = 0; // 0:初期, 1:右端, 2:消えた
  const animationDurationSec = 6;

  // 初期位置リセット
  function resetGifPosition() {
    gifs.forEach((gif, i) => {
      gif.src = "09.gif";
      gif.style.transition = 'none';
      gif.style.left = (-i * 120) + 'vw';
      void gif.offsetWidth;
      gif.style.transition = `left ${animationDurationSec}s cubic-bezier(0,0,0.2,1)`;
    });
    moveState = 0;
  }

  // 右に移動
  function animateGif() {
    if (moveState === 0) {
      // 1回目: 右端まで移動
      moveState = 1;
      gifs.forEach((gif, i) => {
        gif.src = "09m.gif";
        const checkReady = setInterval(() => {
          if (gif.naturalWidth > 0) {
            clearInterval(checkReady);
            const scale = gif.getBoundingClientRect().height / gif.naturalHeight;
            const gifWidth = gif.naturalWidth * scale;
            // 3体を等間隔で配置
            const rightStop = window.innerWidth - gifWidth - (i * gifWidth * 1.1);
            gif.style.left = rightStop + 'px';
          }
        }, 100);
      });
    } else if (moveState === 1) {
      // 2回目: 画面外右へ移動
      moveState = 2;
      gifs.forEach((gif, i) => {
        gif.src = "09m.gif";
      });
      // 全てのgifのtransitionを一旦noneにして右端に揃える
      setTimeout(() => {
        gifs.forEach((gif, i) => {
          const scale = gif.getBoundingClientRect().height / gif.naturalHeight;
          const gifWidth = gif.naturalWidth * scale;
          const rightStop = window.innerWidth - gifWidth - (i * gifWidth * 1.1);
          gif.style.transition = 'none';
          gif.style.left = rightStop + 'px';
        });
        // 再描画後、全て同じtransitionで画面外右へ
        setTimeout(() => {
          gifs.forEach((gif, i) => {
            const scale = gif.getBoundingClientRect().height / gif.naturalHeight;
            const gifWidth = gif.naturalWidth * scale;
            gif.style.transition = `left ${animationDurationSec}s cubic-bezier(0,0,0.2,1)`;
            gif.style.left = (window.innerWidth + (i * gifWidth * 1.1)) + 'px';
          });
        }, 20);
      }, 20);
    }
  }

  // 初期設定
  window.addEventListener('load', resetGifPosition);
  window.addEventListener('resize', () => {
    if (moveState === 0) resetGifPosition();
  });

  // クリックやタッチで発動
  scene.addEventListener('click', (e) => {
    if (!e.target.closest('button')) animateGif();
  });
  scene.addEventListener('touchstart', (e) => {
    if (!e.target.closest('button')) animateGif();
  });
})();
</script>
</body>
</html>
